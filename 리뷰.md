 ☒ ProductInfo.tsx에서 상단 가격 계산기 버튼 제거
     ☒ calculations.ts 계산 로직 수정 (관세사/원산지증명서 금액, 부가세 계산)
     ☒ PriceCalculator.tsx 초기값 변경 및 마진/판매가 제거
     ☒ FCL 운송비 직접 입력 필드 추가
     ☐ 여러 SKU 선택 시 CBM 합산 로직 구현


● Read(nextjs_flexy\src\app\1688\product\[offerId]\components\PriceCalculator.tsx)

  ⎿  Read 15 lines (ctrl+r to expand)


● PriceCalculator 컴포넌트는 단일 SKU와 quantity를 받고 있습니다. 여러 SKU를 지원하려면 상위 컴포넌트에서 선택된 SKU들의 정보를 전달받아야 합니다. 먼저 현재 구조를     
   유지하면서 단일 SKU의 포장 정보를 자동으로 적용하도록 수정하겠습니다.


● Update(nextjs_flexy\src\app\1688\product\[offerId]\components\PriceCalculator.tsx)

  ⎿  Updated nextjs_flexy\src\app\1688\product\[offerId]\components\PriceCalculator.tsx with 36 additions and 11 removals
        99            packageHeight: 0
       100          };
       101
       102 -        if (selectedSku && productDetail.productShippingInfo?.skuShippingDetails) {
       103 -          const skuShipping = productDetail.productShippingInfo.skuShippingDetails.find(
       104 -            detail => detail.skuId === selectedSku.skuId?.toString()
       105 -          );
       106 -          if (skuShipping) {
       107 -            packageInfo = {
       108 -              packageWeight: skuShipping.grossWeight || 0,
       109 -              packageLength: skuShipping.packageLength || 0,
       110 -              packageWidth: skuShipping.packageWidth || 0,
       111 -              packageHeight: skuShipping.packageHeight || 0
       112 -            };
       102 +        // SKU 선택된 경우 해당 SKU의 포장 정보 사용
       103 +        if (selectedSku) {
       104 +          // productShippingInfo.skuShippingDetails에서 찾기
       105 +          if (productDetail.productShippingInfo?.skuShippingDetails) {
       106 +            const skuShipping = productDetail.productShippingInfo.skuShippingDetails.find(
       107 +              detail => detail.skuId === selectedSku.skuId?.toString()
       108 +            );
       109 +            if (skuShipping) {
       110 +              packageInfo = {
       111 +                packageWeight: skuShipping.grossWeight || 0,
       112 +                packageLength: skuShipping.packageLength || 0,
       113 +                packageWidth: skuShipping.packageWidth || 0,
       114 +                packageHeight: skuShipping.packageHeight || 0
       115 +              };
       116 +            }
       117            }
       118 +
       119 +          // skuShippingDetails에 없으면 SKU 속성에서 찾기
       120 +          if (packageInfo.packageWeight === 0 && selectedSku.skuAttributes) {
       121 +            // SKU 속성에 포장 정보가 있는 경우 (예: 무게, 크기 등)
       122 +            selectedSku.skuAttributes.forEach((attr: any) => {
       123 +              if (attr.attributeName?.includes('重量') || attr.attributeName?.includes('weight')) {
       124 +                const weight = parseFloat(attr.value);
       125 +                if (!isNaN(weight)) packageInfo.packageWeight = weight;
       126 +              }
       127 +            });
       128 +          }
       129 +        } 
       130 +        // SKU가 없으면 기본 상품 포장 정보 사용
       131 +        else if (productDetail.productShippingInfo) {
       132 +          const shipping = productDetail.productShippingInfo;
       133 +          packageInfo = {
       134 +            packageWeight: shipping.grossWeight || 0,
       135 +            packageLength: shipping.packageLength || 0,
       136 +            packageWidth: shipping.packageWidth || 0,
       137 +            packageHeight: shipping.packageHeight || 0
       138 +          };
       139          }
       140
       141          setCalculatorData(prev => ({

================================================================= Previous Conversation Compacted =================================================================     
● Compact summary (ctrl+r to expand)
  ⎿  Referenced file nextjs_flexy\src\app\1688\product\[offerId]\components\PriceCalculator.tsx
  ⎿  Read nextjs_flexy\src\app\1688\product\[offerId]\utils\calculations.ts (202 lines)
  ⎿  Referenced file nextjs_flexy\src\app\1688\product\[offerId]\components\ProductInfo.tsx
  ⎿  Read nextjs_flexy\src\app\1688\product\[offerId]\page.tsx (461 lines)
  ⎿  Referenced file nextjs_flexy\src\app\1688\search-v2\page.tsx
  ⎿  Todo list read (5 items)

● 여러 SKU 선택 시 CBM 합산 로직을 구현하겠습니다. 먼저 현재 SKU 선택 구조를 확인하고 수정하겠습니다.

● Read(nextjs_flexy\src\app\1688\product\[offerId]\components\SkuSelector.tsx)
  ⎿  Read 1128 lines (ctrl+r to expand)

● 이제 PriceCalculator 컴포넌트를 수정하여 여러 SKU 선택 시 CBM을 합산하는 로직을 구현하겠습니다.

● Read(nextjs_flexy\src\app\1688\product\[offerId]\components\PriceCalculator.tsx)
  ⎿  Read 200 lines (ctrl+r to expand)

● 이제 페이지 컴포넌트를 수정하여 여러 SKU 선택 정보를 PriceCalculator에 전달하도록 수정하겠습니다.

  Update(nextjs_flexy\src\app\1688\product\[offerId]\page.tsx)
  ⎿  Updated nextjs_flexy\src\app\1688\product\[offerId]\page.tsx with 34 additions
       51      const [selectedSku, setSelectedSku] = useState<any>(null);
       52      const [selectedAttributes, setSelectedAttributes] = useState<{ [key: string]: string }>({});
       53      const [calculatorOpen, setCalculatorOpen] = useState(false);
       54 +    const [selectedSkuQuantities, setSelectedSkuQuantities] = useState<{ [key: string]: number }>({});
       55 +    const [selectedSkus, setSelectedSkus] = useState<any[]>([]);
       56    
       57      // 번역 관련 상태
       58      const [translatingImage, setTranslatingImage] = useState<string | null>(null);
     ...
       320                          const total = Object.values(quantities).reduce((sum, qty) => sum + qty, 0);
       321                          if (total > 0) {
       322                            setQuantity(total);
       323 +                          setSelectedSkuQuantities(quantities);
       324 +
       325 +                          // 선택된 SKU들 정보 수집
       326 +                          const skus: any[] = [];
       327 +                          Object.entries(quantities).forEach(([key, qty]) => {
       328 +                            if (qty > 0) {
       329 +                              // 색상-사이즈 키 또는 sku-id 키 파싱
       330 +                              if (key.startsWith('sku-')) {
       331 +                                const skuId = key.replace('sku-', '');
       332 +                                const sku = productDetail.productSkuInfos?.find((s: any) => s.skuId === skuId);
       333 +                                if (sku) {
       334 +                                  skus.push({ ...sku, quantity: qty });
       335 +                                }
       336 +                              } else {
       337 +                                // 색상-사이즈 형식
       338 +                                const [color, size] = key.split('-');
       339 +                                const sku = productDetail.productSkuInfos?.find((s: any) => 
       340 +                                  s.skuAttributes?.some((attr: any) => 
       341 +                                    (attr.valueTrans === color || attr.value === color)
       342 +                                  ) &&
       343 +                                  s.skuAttributes?.some((attr: any) => 
       344 +                                    (attr.valueTrans === size || attr.value === size)
       345 +                                  )
       346 +                                );
       347 +                                if (sku) {
       348 +                                  skus.push({ ...sku, quantity: qty });
       349 +                                }
       350 +                              }
       351 +                            }
       352 +                          });
       353 +                          setSelectedSkus(skus);
       354                          }
       355                        }}
       356                      />
     ...
       353            onClose={() => setCalculatorOpen(false)}
       354            productDetail={productDetail}
       355            selectedSku={selectedSku}
       356 +          selectedSkus={selectedSkus}
       357            quantity={quantity}
       358          />
       359

● 이제 PriceCalculator 컴포넌트를 수정하여 여러 SKU의 CBM을 합산하는 로직을 추가하겠습니다.

  Update(nextjs_flexy\src\app\1688\product\[offerId]\components\PriceCalculator.tsx)
  ⎿  Updated nextjs_flexy\src\app\1688\product\[offerId]\components\PriceCalculator.tsx with 65 additions and 3 removals
       35      onClose: () => void;
       36      productDetail: ProductDetail;
       37      selectedSku?: any;
       38 +    selectedSkus?: any[];
       39      quantity: number;
       40    }
       41    
     ...
       43      onClose,
       44      productDetail,
       45      selectedSku,
       46 +    selectedSkus,
       47      quantity
       48    }: PriceCalculatorProps) {
       49
     ...
        99            packageHeight: 0
       100          };
       101
       102 -        // SKU 선택된 경우 해당 SKU의 포장 정보 사용
       103 -        if (selectedSku) {
       102 +        // 여러 SKU 선택된 경우 CBM 합산
       103 +        if (selectedSkus && selectedSkus.length > 0) {
       104 +          let totalCBM = 0;
       105 +          let totalWeight = 0;
       106 +
       107 +          selectedSkus.forEach((sku: any) => {
       108 +            const skuQty = sku.quantity || 1;
       109 +            let skuCBM = 0;
       110 +            let skuWeight = 0;
       111 +
       112 +            // productShippingInfo.skuShippingDetails에서 찾기
       113 +            if (productDetail.productShippingInfo?.skuShippingDetails) {
       114 +              const skuShipping = productDetail.productShippingInfo.skuShippingDetails.find(
       115 +                detail => detail.skuId === sku.skuId?.toString()
       116 +              );
       117 +              if (skuShipping) {
       118 +                const length = skuShipping.packageLength || 0;
       119 +                const width = skuShipping.packageWidth || 0;
       120 +                const height = skuShipping.packageHeight || 0;
       121 +                skuCBM = (length * width * height) / 1000000; // mm³ to m³
       122 +                skuWeight = skuShipping.grossWeight || 0;
       123 +              }
       124 +            }
       125 +
       126 +            // skuShippingDetails에 없으면 SKU 속성에서 찾기
       127 +            if (skuCBM === 0 && sku.skuAttributes) {
       128 +              // SKU 속성에 포장 정보가 있는 경우 (예: 무게, 크기 등)
       129 +              sku.skuAttributes.forEach((attr: any) => {
       130 +                if (attr.attributeName?.includes('重量') || attr.attributeName?.includes('weight')) {
       131 +                  const weight = parseFloat(attr.value);
       132 +                  if (!isNaN(weight)) skuWeight = weight;
       133 +                }
       134 +              });
       135 +            }
       136 +
       137 +            totalCBM += skuCBM * skuQty;
       138 +            totalWeight += skuWeight * skuQty;
       139 +          });
       140 +
       141 +          // CBM을 역산하여 평균 치수 계산 (간단한 방법)
       142 +          // 실제로는 패킹 효율을 고려해야 하지만, 여기서는 단순 합산
       143 +          if (totalCBM > 0) {
       144 +            // CBM에서 평균 치수 역산 (정육면체 가정)
       145 +            const avgDimension = Math.cbrt(totalCBM * 1000000); // m³ to mm³의 세제곱근
       146 +            packageInfo = {
       147 +              packageWeight: totalWeight,
       148 +              packageLength: Math.round(avgDimension),
       149 +              packageWidth: Math.round(avgDimension),
       150 +              packageHeight: Math.round(avgDimension)
       151 +            };
       152 +          } else {
       153 +            // CBM 정보가 없으면 기본값 사용
       154 +            packageInfo = {
       155 +              packageWeight: totalWeight,
       156 +              packageLength: 0,
       157 +              packageWidth: 0,
       158 +              packageHeight: 0
       159 +            };
       160 +          }
       161 +        }
       162 +        // 단일 SKU 선택된 경우 해당 SKU의 포장 정보 사용
       163 +        else if (selectedSku) {
       164            // productShippingInfo.skuShippingDetails에서 찾기
       165            if (productDetail.productShippingInfo?.skuShippingDetails) {
       166              const skuShipping = productDetail.productShippingInfo.skuShippingDetails.find(
     ...
       145            ...packageInfo
       146          }));
       147        }
       148 -    }, [open, productDetail, selectedSku, quantity]);
       148 +    }, [open, productDetail, selectedSku, selectedSkus, quantity]);
       149
       150      // 중국 배송비 조회
       151      const handleFetchChinaShipping = async () => {

● 이제 PriceCalculator에 여러 SKU 선택 시 정보를 표시하는 UI를 추가하겠습니다.

● Read(nextjs_flexy\src\app\1688\product\[offerId]\components\PriceCalculator.tsx)
  ⎿  Read 100 lines (ctrl+r to expand)