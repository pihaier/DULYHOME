name: CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # ë¹Œë“œ ë° íƒ€ì… ì²´í¬
  build:
    name: Build and Type Check
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./nextjs_flexy

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        cache-dependency-path: ./nextjs_flexy/package-lock.json

    - name: Install dependencies
      run: npm ci

    - name: TypeScript type check
      run: npm run type-check

    - name: Run ESLint
      run: npm run lint
      # AI ê°œë°œ í™˜ê²½: ë¦°íŠ¸ ì—ëŸ¬ ì‹œ ë°°í¬ ì°¨ë‹¨

    - name: Check for console.log statements
      run: |
        echo "ğŸ” Checking for console.log statements..."
        if grep -r "console\.log" src/ --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" --exclude-dir=node_modules; then
          echo "âš ï¸ Warning: console.log found in production code. Consider removing them."
          echo "This is currently a warning. Will become an error in the future."
        else
          echo "âœ… No console.log statements found."
        fi

    - name: Build application
      run: npm run build
      env:
        NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL || vars.SUPABASE_URL }}
        NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY || vars.SUPABASE_ANON_KEY }}
        SUPABASE_URL: ${{ vars.SUPABASE_URL }}
        SUPABASE_ANON_KEY: ${{ vars.SUPABASE_ANON_KEY }}

  # Vercel ìë™ ë°°í¬ëŠ” Vercel GitHub Integrationì´ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì œê±°
  # Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ë„ Supabase GitHub Integrationì´ ì²˜ë¦¬