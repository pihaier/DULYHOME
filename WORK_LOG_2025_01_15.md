# 📝 작업 로그 - 2025년 1월 15일

## 🎯 작업 내용: 파일 업로드 시스템 개선

### 1. **문제점**
- 파일들이 Supabase Storage와 uploaded_files 테이블로 이원화되어 관리
- 매번 uploaded_files 테이블을 별도로 조회해야 하는 비효율성
- 파일 관련 정보가 분산되어 있어 관리 복잡

### 2. **해결 방안**
- market_research_requests 테이블에 JSONB 컬럼 추가하여 파일 정보 직접 저장
- uploaded_files 테이블 의존성 제거

### 3. **추가한 컬럼들**
```sql
-- 고객 신청 시 업로드
application_photos JSONB  -- 제품 사진
logo_files JSONB         -- 로고 파일
box_files JSONB          -- 박스/포장 파일

-- 기타
chat_files JSONB         -- 채팅 파일
reference_links JSONB    -- 참고 링크

-- 기존 (유지)
product_actual_photos JSONB -- 중국직원 업로드 사진
```

### 4. **수정한 페이지들**

#### `/application/market-research/page.tsx`
- Storage 업로드 후 URL을 JSONB 컬럼에 직접 저장
- uploaded_files 테이블 insert 제거

#### `/staff/market-research/[reservationNumber]/page.tsx`
- uploaded_files 조회 제거
- data.application_photos에서 직접 읽기
- files, applicationFiles state 제거

#### `/dashboard/orders/market-research/[reservationNumber]/page.tsx`
- uploaded_files 조회 제거
- 컬럼 데이터를 통합하여 files 배열 생성

### 5. **삭제한 불필요한 페이지들**
- `/dashboard/market-research/` - 사용하지 않는 경로
- `/dashboard/bulk-orders/`
- `/dashboard/sample-page/`
- `/dashboard/staff/`

### 6. **기타 수정사항**
- 레이아웃 너비 조정 (market-research: 1600px)
- 제품 정보 필드 재정렬
- 가격 정보 탭 구조 개선
- 모든 가격 소수점 제거 (환율 제외)

## 🔄 파일 처리 흐름 변경

### Before:
```
사용자 업로드 → Storage → uploaded_files 테이블 → 별도 조회
```

### After:
```
사용자 업로드 → Storage → market_research_requests JSONB 컬럼 → 직접 읽기
```

## 📌 다음 작업 예정
- [ ] 채팅 파일 업로드 시 chat_files 컬럼 활용
- [ ] reference_links 관리 UI 추가
- [ ] 기존 uploaded_files 데이터 마이그레이션 스크립트 실행

## 💡 장점
1. **성능 향상**: JOIN 없이 단일 테이블에서 모든 정보 조회
2. **코드 간소화**: 별도 파일 조회 로직 제거
3. **유지보수 용이**: 파일 정보가 한 곳에 집중

## ⚠️ 주의사항
- Storage의 파일은 그대로 유지 (URL만 컬럼에 저장)
- 기존 uploaded_files 테이블은 당분간 유지 (백업용)
- JSONB 컬럼은 배열 형태로 무제한 파일 추가 가능

---
*Commit: fd7fcdb45*